#!/bin/bash
set -e
declare -- rule
rule="$(gcc -MM "$1")"
declare -- base="${1%'.cpp'}"
rule="${rule/"${base}.o"/".${base}.o"} | headers"
rule+=$'\n\t'"\$(if \$(wildcard ${base}.mk.2),,$0 $1)"
rule+=$'\n\t'"\$(CC) \$(CFLAGS) -o .${base}.o -c \$(OFLAGS) $1"
touch "${base}.mk.2"
.extra/proc/goup "${base}.mk.2"
echo "$rule" >.${base}.mk
