#!/bin/bash
if [[ "$1" =~ '.' ]]; then
	echo "invalid name: $1"
	exit 1
fi
IFS= read -d '' info <<'EOF'
#this file is automatically created and modified,
#please do not modify or delete it yourself.
EOF
declare -- rule2
if test -f "${installabs}/lib64/libcustomutils.so"; then
	rule2="$(cc -I "${installabs}/include/" -M "$1.cpp")" || exit $?
else
	rule2="$(cc -I "$(pwd)/libs/include/" -M "$1.cpp")" || exit $?
fi
rule2="$(cc -I "libs/include/" -M "$1.cpp")" || exit $?
declare -- rule="$info"$'\n'"pwd:=\$(shell pwd)"
rule+=$'\n'"winstall=-I \"\$(installabs)/include/\" -L \"\$(installabs)/lib64/\" -Wl,-rpath,\"\$(installabs)/lib64/\" -Wl,-lcustomutils"
rule+=$'\n'"ninstall=-I \"\$(pwd)/libs/include/\" -L \"\$(pwd)/libs/\" -Wl,-rpath,'\$\$ORIGIN/libs/' -Wl,-l:.shared.so"
rule+=$'\n'"installed:=\$(shell test -f \"\$(installabs)\"/lib64/libcustomutils.so && echo \"true\")"$'\n'"$rule2"
rule+=$'\n\t'"\$(if \$(wildcard .$1.mk.2),rm .$1.mk.2,$0 $*)"
rule+=$'\n\t'"gcc -std=c++2a -O3 -Wall -Wextra -o $1.o $1.cpp -lstdc++ -Wl,--disable-new-dtags \
\$(if \$(installed),\$(winstall),\$(ninstall))"
echo "this file should only exist during make, if it still exists afterwords, please remove it" >".$1.mk.2"
echo "$rule" >".$1.mk"
